{% extends 'base.html' %}
{% block content %}
<style>
  .events-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
    padding-bottom: 15px;
    border-bottom: 2px solid #e0e0e0;
  }

  .events-header h3 {
    margin: 0;
    font-size: 24px;
    font-weight: 600;
    color: #2c3e50;
  }

  .hamburger-menu {
    position: relative;
    display: inline-block;
  }

  .hamburger-icon {
    cursor: pointer;
    display: flex;
    flex-direction: column;
    gap: 4px;
    padding: 8px;
  }

  .hamburger-icon span {
    width: 24px;
    height: 3px;
    background-color: #333;
    border-radius: 2px;
    transition: all 0.3s;
  }

  .hamburger-menu-dropdown {
    display: none;
    position: absolute;
    right: 0;
    top: 100%;
    background-color: white;
    border: 1px solid #ddd;
    border-radius: 5px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.15);
    min-width: 150px;
    z-index: 1000;
    margin-top: 5px;
  }

  .hamburger-menu-dropdown.show {
    display: block;
  }

  .hamburger-menu-dropdown a,
  .hamburger-menu-dropdown button {
    display: block;
    width: 100%;
    padding: 12px 16px;
    text-align: left;
    text-decoration: none;
    color: #333;
    background: none;
    border: none;
    cursor: pointer;
    font-size: 14px;
    transition: background-color 0.2s;
  }

  .hamburger-menu-dropdown a:hover,
  .hamburger-menu-dropdown button:hover {
    background-color: #f5f5f5;
  }

  .hamburger-menu-dropdown form {
    margin: 0;
  }

  .pets-section {
    display: flex;
    align-items: flex-start;
    gap: 20px;
    margin-bottom: 20px;
    padding: 15px;
    background-color: #f9f9f9;
    border-radius: 8px;
  }

  .pets-container {
    display: flex;
    gap: 20px;
    flex-wrap: wrap;
  }

  .pet-item {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 8px;
  }

  .pet-item img {
    width: 60px;
    height: 60px;
    border-radius: 50%;
    object-fit: cover;
    border: 2px solid #ddd;
  }

  .pet-item .pet-name {
    font-size: 12px;
    color: #555;
    text-align: center;
  }

  /* Event type row colors */
  tr[data-event-type="Food"] {
    background-color: #ffe0e6; /* Light pink */
  }

  tr[data-event-type="Litter"] {
    background-color: #fff9e6; /* Light yellow */
  }

  tr[data-event-type="Medicine"] {
    background-color: #e0f4f4; /* Light blue/teal */
  }

  tr[data-event-type="Food"]:hover {
    background-color: #ffd0d9;
  }

  tr[data-event-type="Litter"]:hover {
    background-color: #fff4d0;
  }

  tr[data-event-type="Medicine"]:hover {
    background-color: #d0eaea;
  }

  table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 10px;
  }

  table thead {
    background-color: #f5f5f5;
  }

  table th {
    padding: 12px;
    text-align: left;
    font-weight: 600;
    color: #2c3e50;
    border-bottom: 2px solid #e0e0e0;
  }

  table td {
    padding: 12px;
    vertical-align: middle;
    border-bottom: 1px solid #e0e0e0;
  }

  table tbody tr:last-child td {
    border-bottom: none;
  }

  .new-event {
    margin-bottom: 20px;
  }

  .new-event button {
    background-color: #4a90e2;
    color: white;
    border: none;
    padding: 10px 20px;
    border-radius: 5px;
    cursor: pointer;
    font-size: 14px;
    transition: background-color 0.2s;
  }

  .new-event button:hover {
    background-color: #357abd;
  }
</style>

<div class="row-fluid">
  <div class="events-header">
    <h3>{{ household_name }}</h3>
    <div class="hamburger-menu">
      <div class="hamburger-icon" onclick="toggleMenu()" aria-label="Open menu">
        <span></span>
        <span></span>
        <span></span>
      </div>
      <div class="hamburger-menu-dropdown" id="menuDropdown">
        <form action="/logout" method="get">
          <button type="submit" aria-label="Log out">Log Out</button>
        </form>
        <button type="button" aria-label="Placeholder option">[Placeholder Option]</button>
      </div>
    </div>
  </div>

  <div class="pets-section">
    <div class="pets-container">
      {% for pet in pets %}
        <div class="pet-item">
          {% if pet['photo_addr'] %}
            <img src="/{{ pet['photo_addr'] }}" alt="{{ pet['name'] }}" title="{{ pet['name'] }}" />
          {% else %}
            <div style="width: 60px; height: 60px; border-radius: 50%; background-color: #ddd; display: flex; align-items: center; justify-content: center; border: 2px solid #ddd;">
              <span style="font-size: 24px;">üê±</span>
            </div>
          {% endif %}
          <span class="pet-name">{{ pet['name'] }}</span>
        </div>
      {% endfor %}
    </div>
  </div>

  {% if error %}
    <div class="error">{{ error }}</div>
  {% endif %}
  {% if created %}
    <div style="background-color: #d4edda; color: #155724; padding: 12px; border-radius: 5px; margin-bottom: 20px; border-left: 4px solid #28a745;">
      Event created successfully!
    </div>
  {% endif %}
  <div>
    <form action="/events/new" method="get" class="new-event">
      <button type="submit" aria-label="Add new event">Add Event</button>
    </form>
  </div>
  <table role="table" aria-label="Events table">
    <thead>
      <tr>
        <th scope="col">Type</th>
        <th scope="col">Pet</th>
        <th scope="col">Meta</th>
        <th scope="col">Timestamp</th>
      </tr>
    </thead>
    <tbody>
    {% for event in events %}
      <tr data-event-type="{{ event['type'] }}">
        <td>
          <img src="/assets/{{ event['type'] }}Icon.svg" alt="{{ event['type'] }}" title="{{ event['type'] }}" aria-label="{{ event['type'] }} event type icon" style="width: 50px; height: 50px; vertical-align: middle;" />
        </td>
        <td>
          {%if event['pet-name'] %}
            <img src="/{{ event['pet-icon'] }}" alt="{{ event['pet-name'] }}" title="{{ event['pet-name'] }}" aria-label="{{ event['pet-name'] }} pet icon" style="width: 50px; height: 50px; vertical-align: middle;" />
          {% endif %}
        </td>
        <td>
          {%if event['meta'] %}
            {% if event['meta'] is mapping %}
              {% if event['type'] == 'Food' and event['meta'].get('name') %}
                {{ event['meta']['name'] }}{% if event['meta'].get('calories') %} ({{ event['meta']['calories'] }} calories){% endif %}
              {% elif event['type'] == 'Medicine' and event['meta'].get('name') %}
                {{ event['meta']['name'] }}{% if event['meta'].get('dose') %}, {{ event['meta']['dose'] }}{% endif %}
              {% else %}
                {{ event['meta'] }}
              {% endif %}
            {% else %}
              {{ event['meta'] }}
            {% endif %}
          {% endif %}
        </td>
        <td>
          {% if event['timestamp'] %}
            {{ event['timestamp'].strftime('%Y-%m-%d %H:%M:%S') if event['timestamp'] is not string else event['timestamp'] }}
          {% endif %}
        </td>
      </tr>
    {% endfor %}
    </tbody>
  </table>
</div>

<script>
  function toggleMenu() {
    const dropdown = document.getElementById('menuDropdown');
    dropdown.classList.toggle('show');
  }

  // Close menu when clicking outside
  document.addEventListener('click', function(event) {
    const menu = document.querySelector('.hamburger-menu');
    const dropdown = document.getElementById('menuDropdown');
    if (menu && dropdown && !menu.contains(event.target)) {
      dropdown.classList.remove('show');
    }
  });
</script>

{% endblock %}
