{% extends 'base.html' %}
{% block content %}

<div class="row-fluid">

  <div class="pets-section">
    <div class="pets-container">
      {% for pet in pets %}
        <div class="pet-item">
          {% if pet['photo_addr'] %}
            <img src="/{{ pet['photo_addr'] }}" alt="{{ pet['name'] }}" title="{{ pet['name'] }}" />
          {% else %}
            <div class="pet-placeholder">
              <span>ğŸ±</span>
            </div>
          {% endif %}
          <span class="pet-name">{{ pet['name'] }}</span>
        </div>
      {% endfor %}
    </div>
  </div>

  {% if error %}
    <div class="error">{{ error }}</div>
  {% endif %}
  {% if created %}
    <div class="success">
      Event created successfully!
    </div>
  {% endif %}
  <div>
    <form action="/events/new" method="get" class="new-event">
      <button type="submit" aria-label="Add new event">Add Event</button>
    </form>
  </div>
  <table role="table" aria-label="Events table">
    <thead>
      <tr>
        <th scope="col">Type</th>
        <th scope="col">Pet</th>
        <th scope="col">Meta</th>
        <th scope="col">Timestamp</th>
      </tr>
    </thead>
    <tbody>
    {% for event in events %}
      <tr data-event-type="{{ event['type'] }}">
        <td class="event-type-icon">
          <img src="/assets/{{ event['type'] }}Icon.svg" alt="{{ event['type'] }}" title="{{ event['type'] }}" aria-label="{{ event['type'] }} event type icon" class="event-icon" />
        </td>
        <td class="event-pet-icon">
          {%if event['pet-name'] %}
            <img src="/{{ event['pet-icon'] }}" alt="{{ event['pet-name'] }}" title="{{ event['pet-name'] }}" aria-label="{{ event['pet-name'] }} pet icon" class="event-icon" />
          {% endif %}
        </td>
        <td>
          {%if event['meta'] %}
            {% if event['meta'] is mapping %}
              {% if event['type'] == 'Food' and event['meta'].get('name') %}
                {{ event['meta']['name'] }}{% if event['meta'].get('calories') %} ({{ event['meta']['calories'] }} calories){% endif %}
              {% elif event['type'] == 'Medicine' and event['meta'].get('name') %}
                {{ event['meta']['name'] }}{% if event['meta'].get('dose') %}, {{ event['meta']['dose'] }}{% endif %}
              {% else %}
                {{ event['meta'] }}
              {% endif %}
            {% else %}
              {{ event['meta'] }}
            {% endif %}
          {% endif %}
        </td>
        <td>
          {% if event['timestamp'] %}
            {{ event['timestamp'].strftime('%Y-%m-%d %H:%M:%S') if event['timestamp'] is not string else event['timestamp'] }}
          {% endif %}
        </td>
      </tr>
    {% endfor %}
    </tbody>
  </table>
</div>

{% endblock %}
